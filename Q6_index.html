<!DOCTYPE html>
<html>
    <head>
        <title>Order Table JS</title>
        <style>
            table {
				font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
				border-collapse: collapse;
				width: auto;
				margin: 0;
				padding: 10px;
			}

			th {
				background-color: blanchedalmond;
                text-align: center;
			}

			th, td {
				padding: 8px;
				border: 1px solid;
			}

            td {
                text-align: left;
            }
        </style>
        <script>
            // head
            const xhttp = new XMLHttpRequest();

            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    displayData(this.responseXML);
                }
            };

            xhttp.open("GET", "./Q6_Order.xml", true);

            xhttp.send();
            
            // loop 
            const displayData = (xmlDoc) => {
                let tableElement = document.getElementById("table");
                const itemNodes = xmlDoc.getElementsByTagName("item");

                for(let i = 0; i < itemNodes.length; i++){
                    // get the current item node
                    const item = itemNodes[i];

                    // Parse the item node to extract information
                    const parseItems = parseItem(item);

                    // Create a table row element with the parsed item's information
                    const rowElement = createRow(parseItems);

                    // append the row to the table
                    tableElement.appendChild(rowElement);
 
                }
            };

            // function to create row
            const createRow = (parseItems) => 
                stringToNode(`<tr>
                    <td>${parseItems.oid}</td>
                    <td>${parseItems.customerName}</td>
                    <td>${parseItems.email}</td>
                    <td>${parseItems.status}</td>
                    <td>${parseItems.instock}</td>
                    <td>${parseItems.itemid}</td>
                    <td>${parseItems.name}</td>
                    <td>${parseItems.price}</td>
                    <td>${parseItems.qty}</td>
                    <td>${parseItems.shippingDetails}</td>
                </tr>`);

            // function to parse
            const parseItem = (item) => {
                const oid = item.parentNode.getAttribute("oid");
                const customerName = item.parentNode.getElementsByTagName("customerInfo")[0].getElementsByTagName("customerName")[0].childNodes[0].nodeValue;
                const email = item.parentNode.getElementsByTagName("customerInfo")[0].getElementsByTagName("email")[0].childNodes[0].nodeValue;
                const status = item.parentNode.getElementsByTagName("status")[0].childNodes[0].nodeValue;
                const instock = item.getAttribute("instock");
                const itemid = item.getAttribute("itemid");
                const name = item.getElementsByTagName("name")[0].childNodes[0].nodeValue;
                const price = item.getElementsByTagName("price")[0].childNodes[0].nodeValue;
                const qty = item.getElementsByTagName("qty")[0].childNodes[0].nodeValue;
                const shippingDetails = item.parentNode.getElementsByTagName("shippingDetails")[0] ? item.parentNode.getElementsByTagName("shippingDetails")[0].childNodes[0].nodeValue:"";
                
                return { oid, customerName, email, status, instock, itemid, name, price, qty, shippingDetails };
            };
            
            // convert string to node
            const stringToNode = (html) => {
                // Creating a template element
                const template = document.createElement(`template`);
    
                // Trimming the input HTML string and setting it as the template's innerHTML
                html = html.trim();
                template.innerHTML = html;

                // Returning the first child of the template's content
                return template.content.firstChild;
            };
        </script>
    </head>
    <body>
        <h1>List of all Order Details</h1>
        <table id="table">
            <tr>
                <tr>
                    <th>Order Id</th>
                    <th>Customer Name</th>
                    <th>Email</th>
                    <th>Status</th>
                    <th>Item Instock</th>
                    <th>Item Id</th>
                    <th>Item Name</th>
                    <th>Price</th>
                    <th>Qty</th>
                    <th>shippingDetails</th>
                </tr>
            </tr>
        </table>
    </body>
</html>